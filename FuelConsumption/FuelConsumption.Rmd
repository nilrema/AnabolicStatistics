---
title: "Potrošnja goriva po regijama"
author: "Ivan Skukan"
output:
  pdf_document: default
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Pitanje 
**Postoje li razlike u potrošnji automobila prema regiji kojoj pripada proizvođač?**

#Uvod 
Da odgovorimo na ovo pitanje, moramo analizirati podatke potrošnje
goriva na 3 kontinenta. Zbog činjenice da imamo više od 2 regije,
analiza varijance (ANOVA) će biti naš odabir modeliranja, ali prije toga ćemo morati testirati uvjete ANOVA-e. Prvo ćemo
učitati podatke i onda pretvoriti relevantne stupce u faktore kako bi
izbjegli potencijalne greške u programiranju Učitavanje i čiščenje
podataka:

```{r}
path <- "car_specifications.csv"
data <- read.csv(path)

data$continent = as.factor(data$continent)
data$country = as.factor(data$country)
head(data)
```

**Uvjeti za ANOVA-u**
Kako bi proveli ANOVA test na podacima, prvo moramo biti sigurni da dani podaci zadovoljavaju sljedeće uvjete:
1. Normalnost 
2. Nezavisnost
3. Homogenost varijanci

#lillie 
**Testiranje normalnosti** 
Prvo ćemo proveti test normalnosti. Zanimaju nas
tablice za potrošnju goriva u gradu i na autocesti. Nakon toga nas zanimaju isti ti podaci za različite kontinente. Koristit ćemo
Lilliefors test koji se temelji na Kolmogorov-Smirnov testu i Q-Q plot za vizualizaciju. Postavljamo
hipoteze:
$$H0: Dani\ podaci\ za\ potrošnju\ goriva\ imaju\ normalnu\ distribuciju\\
H1: \neg H0$$

Provedimo test:

```{r}
require(nortest) #potrebna biblioteka

lillie.test(data$city.L.100km)
lillie.test(data$highway.L.100km)
```
Za oba testa smo dobili jako malu p-vrijednost. Možemo uvjereno odbaciti
H0 i zaključiti da podaci nisu normalno distribuirani.
Histogrami i Q-Q plotovi(prvi histogram/Q-Q je za gradove, drugi za autoceste):
```{r}
#hist za svaki test
hist(data$city.L.100km)
hist(data$highway.L.100km)

#qq #probaj koristit i za anovu!!!!
qqnorm(data$city.L.100km)
qqline(data$city.L.100km)


qqnorm(data$highway.L.100km)
qqline(data$highway.L.100km)


```
Histogrami očito pokazuju kako podaci ne prate normalnu distribuciju. Osim toga, na Q-Q grafu vidimo kako podaci ne prate baš prilagođenu liniju.

Ako provedemo isti test, ali ovaj put po kontinentima, imat ćemo iste zaključke. Prvo postavljamo
hipoteze:
$$H0: Dani\ podaci\ za\ potrošnju\ goriva\ imaju\\ normalnu\ distribuciju\ po\ kontinentima\\
H1: \neg H0$$

Pokrenimo kod:

```{r}
continents = unique(data$continent) #lista svih kontinenta
for (continent in continents) {
  print(paste("For continent:",continent))
  print(lillie.test(data$city.L.100km[data$continent == continent]))
  print(lillie.test(data$highway.L.100km[data$continent == continent]))
  hist(data$highway.L.100km[data$continent == continent])
  hist(data$city.L.100km[data$continent == continent])
}
```

Vidimo da smo i po kontinentima dobili male p-vrijednosti. Opet
odbacujemo H0 i zaključujemo da podaci ne prate normalnu distribuciju. Isto možemo zaključiti iz histograma.


Q-Q:
```{r}
qqnorm(data$highway.L.100km[data$continent == "Asia"],main="Asia, highways")
qqline(data$highway.L.100km[data$continent == "Asia"])
qqnorm(data$city.L.100km[data$continent == "Asia"],main = "Asia, cities")
qqline(data$city.L.100km[data$continent == "Asia"])
qqnorm(data$highway.L.100km[data$continent == "North America"],main = "NA,highways")
qqline(data$highway.L.100km[data$continent == "North America"])
qqnorm(data$city.L.100km[data$continent == "North America"],main = "NA, cities")
qqline(data$city.L.100km[data$continent == "North America"])
qqnorm(data$highway.L.100km[data$continent == "Europe"],main = "Europe, highways")
qqline(data$highway.L.100km[data$continent == "Europe"])
qqnorm(data$city.L.100km[data$continent == "Europe"],main = "Europe, cities")
qqline(data$city.L.100km[data$continent == "Europe"])
```

Zbog neispunjenog uvjeta normalnosti, okrećemo se Kruskal-Wallis testu, koji funkcionira kao neparametarska ANOVA
Uvjet Kruskal-Wallis testa je da je broj uzoraka barem 5, što lagano vidimo da je zadovoljeno čitajući tablicu.

Hipoteze:
$$H0:\ Očekivana\ vrijednost\ uzoraka\ je\ jednaka\\
H1: Barem\ dvije\ očekivane\ vrijednosti\ se\ razlikuju$$
(Postavljamo istu hipotezu za gradove i autoceste te zbog toga provodimo test dvaput)

Provedimo Kruskal-Wallis test:
```{r}
filteredDataHighway = list(Asia_Highway = data$highway.L.100km[data$continent == "Asia"], NA_Highway = data$highway.L.100km[data$continent == "North America"], Europe_Highway = data$highway.L.100km[data$continent == "Europe"])
filteredDataCity = list(Asia_City = data$city.L.100km[data$continent == "Asia"], NA_City = data$city.L.100km[data$continent == "North America"], Europe_City = data$city.L.100km[data$continent == "Europe"])

kruskalHighway = kruskal.test(filteredDataHighway)
kruskalCity = kruskal.test((filteredDataCity))
print(kruskalHighway)
```
Provjerimo prvo rezultat za autoceste. Dobili smo vrlo malu p-vrijednost, dakle bez sumnje odbacujemo H0 i zaključujemo da se barem dvije očekivane vrijednosti razlikuju.

Provjerimo sad rezultat za gradove:
```{r}
print(kruskalCity)
```
Opet imamo vrlo malu p-vrijednost. Za gradove također odbacujemo H0.

Boxplotovi:
```{r}
boxplot(filteredDataHighway)
boxplot(filteredDataCity)

```
Na temelju boxplotova možemo vidjeti u oba da se Europa najviše razlikuje od ostalih. Možemo koristiti Dunnov test da vidimo između kojih grupa su razlike značajne. Dunnov test ima istu hipotezu kao Kruskal-Wallis test
```{r}
require(dunn.test)
dunn = dunn.test(data$highway.L.100km,g = data$continent,method="bonferroni")
print(dunn)
```
Zanima nas "p-adjusted" redak koji se također može vidjeti u tablici(drugi redak u svakoj čeliji).
Vidimo da je p-adjusted za North_America-Asia relativno velik i nije signifikantan na niti jednoj tipičnoj razini. Međutim, imamo vrlo male p-adjusted vrijednosti između Europe i bilo kojeg drugog kontinenta.
Ovime možemo zaključiti da je odbijanje nul hipoteze Kruskal-Wallis testa
bilo primarno zbog razine potrošnje u Europi.
#pitaj za dunnov test!!!!